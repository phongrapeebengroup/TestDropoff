<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baanpong Drop-off</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- LINE LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- SweetAlert2 for nice alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0fdf4; /* Green-50 */
        }
        .form-section {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            border-color: #16a34a; /* Green-600 */
            ring: 2px solid #16a34a;
        }
        .section-title {
            color: #15803d; /* Green-700 */
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #bbf7d0;
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body class="text-gray-700">

    <!-- Header -->
    <div class="bg-green-600 text-white p-4 shadow-md sticky top-0 z-10">
        <div class="max-w-md mx-auto flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            <div>
                <h1 class="text-xl font-bold">Baanpong</h1>
                <p class="text-xs text-green-100">‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏î‡∏£‡∏≠‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-md mx-auto p-4 pb-20">
        
        <form id="dropoffForm">
            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ Line (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
            <div id="profileSection" class="hidden mb-4 text-center">
                <img id="userPicture" src="" alt="Profile" class="w-16 h-16 rounded-full mx-auto border-4 border-white shadow-sm mb-2">
                <p id="userName" class="font-bold text-green-700"></p>
            </div>

            <!-- Section 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á -->
            <div class="form-section">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                    1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ <span class="text-red-500">*</span></label>
                        <input type="text" id="project" class="input-field" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-500">*</span></label>
                        <input type="text" id="fullname" class="input-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span class="text-red-500">*</span></label>
                        <input type="text" id="memberId" class="input-field" placeholder="‡πÄ‡∏ä‡πà‡∏ô EMP001" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏™‡πà‡∏á <span class="text-red-500">*</span></label>
                        <input type="date" id="date" class="input-field" required>
                    </div>
                </div>
            </div>

            <!-- Section 2: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• -->
            <div class="form-section">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z" />
                        <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                    2. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏™‡∏î‡∏∏ (‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì)
                </div>
                <p class="text-xs text-gray-500 mb-4">* ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡πÉ‡∏™‡πà 0 ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ)</p>

                <div class="grid grid-cols-1 gap-4">
                    <!-- Item 1 -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label class="text-sm font-bold">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</label>
                            <input type="number" id="paper" class="input-field mt-1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0">
                        </div>
                    </div>

                    <!-- Item 2 -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label class="text-sm font-bold">‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</label>
                            <input type="number" id="plastic" class="input-field mt-1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0">
                        </div>
                    </div>

                    <!-- Item 3 -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label class="text-sm font-bold">‡∏Ç‡∏ß‡∏î‡πÅ‡∏Å‡πâ‡∏ß</label>
                            <input type="number" id="glass" class="input-field mt-1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0">
                        </div>
                    </div>

                    <!-- Item 4 -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label class="text-sm font-bold">‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</label>
                            <input type="number" id="aluminum" class="input-field mt-1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0">
                        </div>
                    </div>

                    <!-- Item 5: Others -->
                    <div class="border-t pt-4 mt-2">
                         <label class="text-sm font-bold block mb-2">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</label>
                         <div class="flex gap-2">
                             <input type="text" id="otherType" class="input-field w-2/3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏™‡∏î‡∏∏">
                             <input type="number" id="otherQty" class="input-field w-1/3" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                         </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" id="submitBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition active:scale-95 flex justify-center items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="btnText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            </button>
        </form>
    </div>

    <script>
        // ================= CONFIGURATION =================
        // ‡πÉ‡∏™‡πà Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzPbnSonrQbpbrp2HdTpBfZaIdbZS6z9RtZQfcOnB2I7NcIGh3n94UAchM01c4L06zS/exec"; 
        
        // ‡πÉ‡∏™‡πà LIFF ID (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const MY_LIFF_ID = "2008566287-46dOm6qM"; 
        // =================================================

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('date');
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;

            if (MY_LIFF_ID) {
                initializeLiff(MY_LIFF_ID);
            }
        });

        async function initializeLiff(liffId) {
            try {
                await liff.init({ liffId: liffId });
                if (liff.isLoggedIn()) {
                    getUserProfile();
                }
            } catch (error) {
                console.error("LIFF Init Error:", error);
            }
        }

        async function getUserProfile() {
            try {
                const profile = await liff.getProfile();
                document.getElementById('profileSection').classList.remove('hidden');
                document.getElementById('userPicture').src = profile.pictureUrl;
                document.getElementById('userName').textContent = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, " + profile.displayName;
            } catch (error) {
                console.error("Error getting profile:", error);
            }
        }

        document.getElementById('dropoffForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // ‡∏õ‡∏∏‡πà‡∏° Loading State
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const originalText = btnText.innerText;
            
            submitBtn.disabled = true;
            btnText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const data = {
                project: document.getElementById('project').value,
                fullname: document.getElementById('fullname').value,
                memberId: document.getElementById('memberId').value,
                date: document.getElementById('date').value,
                paper: document.getElementById('paper').value || 0,
                plastic: document.getElementById('plastic').value || 0,
                glass: document.getElementById('glass').value || 0,
                aluminum: document.getElementById('aluminum').value || 0,
                otherType: document.getElementById('otherType').value,
                otherQty: document.getElementById('otherQty').value || 0
            };

            try {
                // 1. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets
                if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL !== "https://script.google.com/macros/s/AKfycbzPbnSonrQbpbrp2HdTpBfZaIdbZS6z9RtZQfcOnB2I7NcIGh3n94UAchM01c4L06zS/exec") {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î Cross-Origin
                        headers: {
                            'Content-Type': 'text/plain'
                        },
                        body: JSON.stringify(data)
                    });
                } else {
                    console.warn("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà GOOGLE_SCRIPT_URL ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheet");
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ LINE
                let messageText = `üì¶ Baanpong Drop-off\n`;
                messageText += `------------------\n`;
                messageText += `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${data.fullname}\n`;
                messageText += `üè¢ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: ${data.project}\n`;
                messageText += `üÜî ‡∏£‡∏´‡∏±‡∏™: ${data.memberId}\n`;
                messageText += `üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${data.date}\n`;
                messageText += `------------------\n`;
                messageText += `‚ôªÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏:\n`;
                if(data.paper > 0) messageText += `- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©: ${data.paper}\n`;
                if(data.plastic > 0) messageText += `- ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å: ${data.plastic}\n`;
                if(data.glass > 0) messageText += `- ‡∏Ç‡∏ß‡∏î‡πÅ‡∏Å‡πâ‡∏ß: ${data.glass}\n`;
                if(data.aluminum > 0) messageText += `- ‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°: ${data.aluminum}\n`;
                if(data.otherQty > 0) messageText += `- ${data.otherType || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}: ${data.otherQty}\n`;

                // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire({
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°',
                    icon: 'success',
                    confirmButtonColor: '#16a34a',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE)
                        if (MY_LIFF_ID && liff.isInClient()) {
                            try {
                                await liff.sendMessages([{ type: 'text', text: messageText }]);
                                liff.closeWindow();
                            } catch (err) {
                                console.error('Send Msg Error:', err);
                                resetForm();
                            }
                        } else {
                            resetForm();
                        }
                    }
                });

            } catch (error) {
                console.error("Error:", error);
                Swal.fire({
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
                    icon: 'error',
                    confirmButtonColor: '#d33'
                });
            } finally {
                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°
                submitBtn.disabled = false;
                btnText.innerText = originalText;
            }
        });

        function resetForm() {
            document.getElementById('dropoffForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }
    </script>
</body>
</html>
